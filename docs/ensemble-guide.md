# Ensemble AI Guide - –û—Ä–∫–µ—Å—Ç—Ä –ò–ò –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–æ–≥–æ —Ü–≤–µ—Ç–∞

## –û–±–∑–æ—Ä

–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω ensemble –ø–æ–¥—Ö–æ–¥ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —Ç—Ä–µ—Ö AI –º–æ–¥–µ–ª–µ–π:
- **Gemini 2.5 Flash** (Google)
- **GPT-4o Vision** (OpenAI)
- **Claude 3.5 Sonnet** (Anthropic)

## –î–≤–∞ –ø–æ–¥—Ö–æ–¥–∞ –∫ –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏–∏

### 1. –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ (Parallel Ensemble)

**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
- –í—Å–µ —Ç—Ä–∏ –º–æ–¥–µ–ª–∏ –∞–Ω–∞–ª–∏–∑–∏—Ä—É—é—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ **–æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ** (–ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ)
- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∞–≥—Ä–µ–≥–∏—Ä—É—é—Ç—Å—è –æ–¥–Ω–∏–º –∏–∑ –º–µ—Ç–æ–¥–æ–≤:
  - **Voting** - –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –≥–æ–ª–æ—Å–æ–≤
  - **Weighted Average** - –≤–∑–≤–µ—à–µ–Ω–Ω–æ–µ —Å—Ä–µ–¥–Ω–µ–µ –ø–æ confidence
  - **Consensus** - —Ç—Ä–µ–±—É–µ—Ç—Å—è ‚â•67% —Å–æ–≥–ª–∞—Å–∏—è

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –ë—ã—Å—Ç—Ä–µ–µ –≤—Å–µ–≥–æ (–≤—Å–µ –º–æ–¥–µ–ª–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ)
- ‚úÖ –†–∞–∑–Ω–æ–æ–±—Ä–∞–∑–Ω—ã–µ –ø–µ—Ä—Å–ø–µ–∫—Ç–∏–≤—ã –æ—Ç —Ä–∞–∑–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π
- ‚úÖ –£—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å –∫ –æ—à–∏–±–∫–∞–º –æ–¥–Ω–æ–π –º–æ–¥–µ–ª–∏

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:**
- –ö–æ–≥–¥–∞ –Ω—É–∂–Ω–∞ —Å–∫–æ—Ä–æ—Å—Ç—å
- –ö–æ–≥–¥–∞ –≤–∞–∂–Ω–∞ —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–Ω–æ—Å—Ç—å –º–Ω–µ–Ω–∏–π
- –î–ª—è –æ–±—â–µ–≥–æ –∞–Ω–∞–ª–∏–∑–∞

**API Endpoint:**
```
POST /api/analyze/color/ensemble/parallel?aggregation_method=weighted_average
```

### 2. –ì–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–¥—Ö–æ–¥ (Hybrid Ensemble)

**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
- –î–≤–µ –º–æ–¥–µ–ª–∏ –∞–Ω–∞–ª–∏–∑–∏—Ä—É—é—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ **–ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ**
- –¢—Ä–µ—Ç—å—è –º–æ–¥–µ–ª—å –≤—ã—Å—Ç—É–ø–∞–µ—Ç –∫–∞–∫ **judge/evaluator** - –æ—Ü–µ–Ω–∏–≤–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–µ—Ä–≤—ã—Ö –¥–≤—É—Ö –∏ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —Ñ–∏–Ω–∞–ª—å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –ë–æ–ª–µ–µ –≥–ª—É–±–æ–∫–∏–π –∞–Ω–∞–ª–∏–∑
- ‚úÖ –≠–∫—Å–ø–µ—Ä—Ç–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
- ‚úÖ –õ—É—á—à–µ–µ –∫–∞—á–µ—Å—Ç–≤–æ –ø—Ä–∏ —Å–ª–æ–∂–Ω—ã—Ö —Å–ª—É—á–∞—è—Ö

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:**
- –ö–æ–≥–¥–∞ –Ω—É–∂–Ω–∞ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Ç–æ—á–Ω–æ—Å—Ç—å
- –î–ª—è —Å–ª–æ–∂–Ω—ã—Ö/–Ω–µ–æ–¥–Ω–æ–∑–Ω–∞—á–Ω—ã—Ö —Å–ª—É—á–∞–µ–≤
- –ö–æ–≥–¥–∞ –≤–∞–∂–Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—è

**API Endpoint:**
```
POST /api/analyze/color/ensemble/hybrid?judge_model=gemini
```

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
uv sync
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ API –∫–ª—é—á–µ–π

–î–æ–±–∞–≤—å—Ç–µ –≤ `.env` —Ñ–∞–π–ª:

```env
GEMINI_API_KEY=your_gemini_key
OPENAI_API_KEY=your_openai_key
ANTHROPIC_API_KEY=your_anthropic_key
```

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ü—Ä–∏–º–µ—Ä 1: –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–π ensemble

```python
from src.services import get_your_color_season_ensemble_parallel

result = await get_your_color_season_ensemble_parallel(
    image_input="base64_string_or_path",
    aggregation_method="weighted_average"  # –∏–ª–∏ "voting", "consensus"
)

print(f"Color Type: {result.personal_color_type}")
print(f"Confidence: {result.confidence}")
print(f"Reasoning: {result.reasoning}")
```

### –ü—Ä–∏–º–µ—Ä 2: –ì–∏–±—Ä–∏–¥–Ω—ã–π ensemble

```python
from src.services import get_your_color_season_ensemble_hybrid

result = await get_your_color_season_ensemble_hybrid(
    image_input="base64_string_or_path",
    judge_model="gemini"  # –∏–ª–∏ "openai", "claude"
)

print(f"Color Type: {result.personal_color_type}")
print(f"Confidence: {result.confidence}")
print(f"Reasoning: {result.reasoning}")
```

### –ü—Ä–∏–º–µ—Ä 3: –ß–µ—Ä–µ–∑ API

#### –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–π –ø–æ–¥—Ö–æ–¥:
```bash
curl -X POST "http://localhost:8000/api/analyze/color/ensemble/parallel?aggregation_method=weighted_average" \
  -H "Content-Type: application/json" \
  -d '{
    "image": "data:image/png;base64,iVBORw0KGgo..."
  }'
```

#### –ì–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–¥—Ö–æ–¥:
```bash
curl -X POST "http://localhost:8000/api/analyze/color/ensemble/hybrid?judge_model=claude" \
  -H "Content-Type: application/json" \
  -d '{
    "image": "data:image/png;base64,iVBORw0KGgo..."
  }'
```

## –ú–µ—Ç–æ–¥—ã –∞–≥—Ä–µ–≥–∞—Ü–∏–∏ (–¥–ª—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞)

### 1. Voting (–ì–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ)
- –ü—Ä–æ—Å—Ç–æ–µ –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –≥–æ–ª–æ—Å–æ–≤ –ø–æ –∫–∞–∂–¥–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
- –°—Ä–µ–¥–Ω–µ–µ confidence
- Confidence –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É–µ—Ç—Å—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –∫–æ–Ω—Å–µ–Ω—Å—É—Å–∞

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:** –ö–æ–≥–¥–∞ –Ω—É–∂–Ω–∞ –ø—Ä–æ—Å—Ç–∞—è –∏ –±—ã—Å—Ç—Ä–∞—è –∞–≥—Ä–µ–≥–∞—Ü–∏—è

### 2. Weighted Average (–í–∑–≤–µ—à–µ–Ω–Ω–æ–µ —Å—Ä–µ–¥–Ω–µ–µ)
- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤–∑–≤–µ—à–∏–≤–∞—é—Ç—Å—è –ø–æ confidence scores
- –ë–æ–ª–µ–µ —É–≤–µ—Ä–µ–Ω–Ω—ã–µ –º–æ–¥–µ–ª–∏ –∏–º–µ—é—Ç –±–æ–ª—å—à–∏–π –≤–µ—Å
- –£—á–∏—Ç—ã–≤–∞–µ—Ç –∫–∞—á–µ—Å—Ç–≤–æ –∫–∞–∂–¥–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:** **–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é** - –ª—É—á—à–∏–π –±–∞–ª–∞–Ω—Å

### 3. Consensus (–ö–æ–Ω—Å–µ–Ω—Å—É—Å)
- –¢—Ä–µ–±—É–µ—Ç ‚â•67% —Å–æ–≥–ª–∞—Å–∏—è –º–µ–∂–¥—É –º–æ–¥–µ–ª—è–º–∏
- –ï—Å–ª–∏ –Ω–µ—Ç –∫–æ–Ω—Å–µ–Ω—Å—É—Å–∞ - —Å–Ω–∏–∂–∞–µ—Ç confidence
- –ë–æ–ª–µ–µ –∫–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω—ã–π –ø–æ–¥—Ö–æ–¥

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:** –ö–æ–≥–¥–∞ –Ω—É–∂–Ω–∞ –≤—ã—Å–æ–∫–∞—è —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ

## –í—ã–±–æ—Ä judge –º–æ–¥–µ–ª–∏ (–¥–ª—è –≥–∏–±—Ä–∏–¥–Ω–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞)

### Gemini (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
- ‚úÖ –ë—ã—Å—Ç—Ä–∞—è
- ‚úÖ –•–æ—Ä–æ—à–æ –ø–æ–Ω–∏–º–∞–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç
- ‚úÖ –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–∞ –¥–ª—è —Å—É–¥–µ–π—Å—Ç–≤–∞

### OpenAI GPT-4o
- ‚úÖ –û—á–µ–Ω—å —Ç–æ—á–Ω–∞—è
- ‚úÖ –ì–ª—É–±–æ–∫–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞
- ‚ö†Ô∏è –ú–µ–¥–ª–µ–Ω–Ω–µ–µ –∏ –¥–æ—Ä–æ–∂–µ

### Claude 3.5 Sonnet
- ‚úÖ –û—Ç–ª–∏—á–Ω–æ–µ reasoning
- ‚úÖ –•–æ—Ä–æ—à–æ –æ–±—ä—è—Å–Ω—è–µ—Ç —Ä–µ—à–µ–Ω–∏—è
- ‚úÖ –ë–∞–ª–∞–Ω—Å —Å–∫–æ—Ä–æ—Å—Ç–∏ –∏ –∫–∞—á–µ—Å—Ç–≤–∞

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

### –î–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞:
1. **–ù–∞—á–Ω–∏—Ç–µ —Å –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞** —Å `weighted_average`
2. –ï—Å–ª–∏ confidence < 0.8, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ **–≥–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–¥—Ö–æ–¥**
3. –î–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö —Å–ª—É—á–∞–µ–≤ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ **–≥–∏–±—Ä–∏–¥–Ω—ã–π** —Å Claude –∫–∞–∫ judge

### –î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:
1. –°—Ä–∞–≤–Ω–∏—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤—Å–µ—Ö —Ç—Ä–µ—Ö –ø–æ–¥—Ö–æ–¥–æ–≤
2. –í—ã–±–µ—Ä–∏—Ç–µ –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–π –¥–ª—è –≤–∞—à–µ–≥–æ use case
3. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–æ—Ä–æ–≥–∏ confidence –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è

## –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–π –ø–æ–¥—Ö–æ–¥:
- –í—Ä–µ–º—è: ~max(–≤—Ä–µ–º—è_–º–æ–¥–µ–ª–∏_1, –≤—Ä–µ–º—è_–º–æ–¥–µ–ª–∏_2, –≤—Ä–µ–º—è_–º–æ–¥–µ–ª–∏_3)
- –û–±—ã—á–Ω–æ: 3-8 —Å–µ–∫—É–Ω–¥

### –ì–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–¥—Ö–æ–¥:
- –í—Ä–µ–º—è: ~max(–≤—Ä–µ–º—è_–º–æ–¥–µ–ª–∏_1, –≤—Ä–µ–º—è_–º–æ–¥–µ–ª–∏_2) + –≤—Ä–µ–º—è_judge
- –û–±—ã—á–Ω–æ: 5-12 —Å–µ–∫—É–Ω–¥

## –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

–°–∏—Å—Ç–µ–º–∞ —É—Å—Ç–æ–π—á–∏–≤–∞ –∫ –æ—à–∏–±–∫–∞–º:
- –ï—Å–ª–∏ –æ–¥–Ω–∞ –º–æ–¥–µ–ª—å –ø–∞–¥–∞–µ—Ç, –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ—Å—Ç–∞–ª—å–Ω—ã—Ö
- –ï—Å–ª–∏ –≤—Å–µ –º–æ–¥–µ–ª–∏ –ø–∞–¥–∞—é—Ç, –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –æ—à–∏–±–∫–∞
- –õ–æ–≥–∏—Ä—É—é—Ç—Å—è –≤—Å–µ –æ—à–∏–±–∫–∏ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

## Best Practices

1. **–í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ ensemble –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –∞–Ω–∞–ª–∏–∑–æ–≤**
2. **–ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ confidence scores** - –Ω–∏–∑–∫–∏–π confidence = –Ω–µ–æ–¥–Ω–æ–∑–Ω–∞—á–Ω—ã–π —Å–ª—É—á–∞–π
3. **–°—Ä–∞–≤–Ω–∏–≤–∞–π—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã** —Ä–∞–∑–Ω—ã—Ö –ø–æ–¥—Ö–æ–¥–æ–≤ –Ω–∞ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
4. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ fallback** - –µ—Å–ª–∏ ensemble –ø–∞–¥–∞–µ—Ç, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ single model
5. **–ö—ç—à–∏—Ä—É–π—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã** –¥–ª—è –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π

## –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø–æ–¥—Ö–æ–¥–æ–≤

| –ö—Ä–∏—Ç–µ—Ä–∏–π | –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–π | –ì–∏–±—Ä–∏–¥–Ω—ã–π |
|----------|--------------|-----------|
| –°–∫–æ—Ä–æ—Å—Ç—å | ‚ö°‚ö°‚ö° –ë—ã—Å—Ç—Ä–µ–µ | ‚ö°‚ö° –ú–µ–¥–ª–µ–Ω–Ω–µ–µ |
| –¢–æ—á–Ω–æ—Å—Ç—å | ‚≠ê‚≠ê‚≠ê –•–æ—Ä–æ—à–∞—è | ‚≠ê‚≠ê‚≠ê‚≠ê –í—ã—à–µ |
| –°—Ç–æ–∏–º–æ—Å—Ç—å | üí∞üí∞ –°—Ä–µ–¥–Ω—è—è | üí∞üí∞üí∞ –í—ã—à–µ |
| –£—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å | ‚úÖ‚úÖ –•–æ—Ä–æ—à–∞—è | ‚úÖ‚úÖ‚úÖ –õ—É—á—à–µ |
| –û–±—ä—è—Å–Ω–∏–º–æ—Å—Ç—å | üìùüìù –°—Ä–µ–¥–Ω—è—è | üìùüìùüìù –õ—É—á—à–µ |

## –ü—Ä–∏–º–µ—Ä—ã —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

### –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–π (weighted_average):
```json
{
  "personal_color_type": "Deep Autumn",
  "confidence": 0.87,
  "undertone": "warm",
  "season": "autumn",
  "subtype": "deep",
  "reasoning": "Ensemble result (weighted by confidence) from 3 models. Primary consensus: 85% weighted agreement on 'Deep Autumn'. Analyses: ..."
}
```

### –ì–∏–±—Ä–∏–¥–Ω—ã–π (Claude judge):
```json
{
  "personal_color_type": "Deep Autumn",
  "confidence": 0.92,
  "undertone": "warm",
  "season": "autumn",
  "subtype": "deep",
  "reasoning": "After evaluating both analyses, I agree with the Deep Autumn classification. The warm undertones and deep chroma are clearly evident..."
}
```

